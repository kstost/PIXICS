(()=>{"use strict";class e extends PIXI.Sprite{constructor(){super(PIXI.Texture.from("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII="))}}class t extends e{spec={};constructor(){super(),this.anchor.y=.5,this.axis=.5,this.thickness=1}set thickness(e){this.height=e}get thickness(){return this.height}set axis(e){this.anchor.x=e}get axis(){return this.anchor.x}set ax(e){this.spec.ax=e,this.calcpos()}get ax(){return this.spec.ax??0}set ay(e){this.spec.ay=e,this.calcpos()}get ay(){return this.spec.ay??0}set bx(e){this.spec.bx=e,this.calcpos()}get bx(){return this.spec.bx??0}set by(e){this.spec.by=e,this.calcpos()}get by(){return this.spec.by??0}get length(){let e=this.ax-this.bx,t=this.ay-this.by;return Math.sqrt(e*e+t*t)}calcpos(){this.width=this.length,this.x=this.bx-(this.bx-this.ax)*(1-this.anchor.x),this.y=this.by-(this.by-this.ay)*(1-this.anchor.x),this.rotation=Math.atan2(this.by-this.ay,this.bx-this.ax)}}let s={setEvent:function(e,t,s){e.interactive=!0,[t].flat(1/0).forEach((t=>e.on(t,s)))},setDotPos:function({x:e,y:t,redraw:s,group:i,global:n}){let o=i&&i.dots[i.class].indexOf(this),a=n.term,l=this,r=e,c=t,d=.5*a<r%a,h=.5*a<c%a,p=JSON.stringify([l.position.x,l.position.y]),u=r-r%a+(d?a:0),y=c-c%a+(h?a:0),g=!0;if(null!==o&&"rect"===i.class){let e=i.dots[i.class].map((e=>({x:e.x,y:e.y})));1!==o||e[0].x-u<0&&e[0].y-y<0||(g=!1)}return g&&(l.position.x=u,l.position.y=y),s&&i&&i.shape&&i.shape.redrawPoly(),p===JSON.stringify([l.position.x,l.position.y])},reAlignLayers:function(e,t){e.forEach(((e,s)=>{e.x=3*t.addBtnSize+40*s}))},getActiveObj:function(e){return e.layerList.filter((e=>e.getGroup().active))[0]},setFirstInvisible:function(e,t){t&&("circle"!==t.class&&"rect"!==t.class||2===t.dots[t.class].length&&(t.dots[t.class][0].interactive=!1,t.dots[t.class][0].alpha=0))}};const i=s,{setFirstInvisible:n,getActiveObj:o,reAlignLayers:a,setDotPos:l,setEvent:r}=i;function c(e,t){let{app:s,group:i}=t;if(!i)return;if(!i.shape){let e=new PIXI.Graphics;e.redrawPoly=function(){const t=e.group;if(t&&t.shape){if(t.shape.clear(),t.shape.lineStyle(4,Number("0x"+t.color)),t.shape.beginFill(Number("0x"+t.color),.5),"polygon"===t.class&&t.shape.drawPolygon(t.dots[t.class].map((e=>[e.x,e.y])).flat(1/0)),"circle"===t.class){let e=t.dots[t.class].map((e=>({x:e.x,y:e.y})));if(2===e.length){let s=ksttool.math.get_distance_between_two_point(e[0],e[1]);t.shape.drawCircle(e[0].x,e[0].y,s)}}if("rect"===t.class){let e=t.dots[t.class].map((e=>({x:e.x,y:e.y})));2===e.length&&t.shape.drawRect(e[0].x,e[0].y,e[1].x-e[0].x,e[1].y-e[0].y)}t.shape.endFill()}},i.shape=e,i.shape.group=i,i.shape.interactive=!0,s.stage.addChild(i.shape);let n=null,o=null,a=null;const l=function(t){if(e.group.layer.emit("mousedown"),!this.group.active)return;this.data=t.data,this.dragging=!0;const s=this.data.getLocalPosition(this.parent);n=s,o={x:0,y:0},a=i.dots[i.class].map((e=>({x:e.x,y:e.y})))},c=function(){this.dragging=!1,this.data=null,n=null,o=null,a=null,m(t)},d=function(e){if(this.dragging){const e=this.data.getLocalPosition(this.parent);let t={x:e.x-n.x,y:e.y-n.y};o.x+=t.x,o.y+=t.y,n=e,i.dots[i.class].forEach(((e,t)=>{e.onDragMove({x:o.x+a[t].x,y:o.y+a[t].y},!0)}))}};r(i.shape,["mousedown","touchstart"],l),r(i.shape,["mousemove","touchmove"],d),r(i.shape,["mouseup","mouseupoutside","touchend","touchendoutside"],c)}let o=new PIXI.Graphics;function a(e,s){let n=e&&"InteractionEvent"!==e.constructor.name;if(n||this.dragging){let o=i.dots[i.class].indexOf(this);if(!s&&0===o&&("rect"===i.class||"circle"===i.class)&&2===i.dots[i.class].length)return;const a=n?e:this.data.getLocalPosition(this.parent);l.bind(this)({...a,redraw:!0,group:i,global:t})}}o.interactive=!0,o.lineStyle(0),o.beginFill(Number("0x"+i.color),1),o.drawCircle(0,0,t.dotsize),o.endFill(),o.group=i,s.stage.addChild(o),i.dots[i.class].push(o),l.bind(o)({...e,redraw:!0,group:i,global:t}),r(o,["mousedown","touchstart"],(function(e){o.group.layer.emit("mousedown"),this.group.active&&(this.data=e.data,this.dragging=!0,t.lastChooseOne=o)})),r(o,["mousemove","touchmove"],a),r(o,["mouseup","mouseupoutside","touchend","touchendoutside"],(function(){this.dragging=!1,this.data=null,m(t)})),o.onDragMove=a,n(t,i),m(t)}const{reAlignLayers:d,setEvent:h,setFirstInvisible:p}=i;function u(e){let{app:t}=e,s={dots:{polygon:[],circle:[],rect:[]},shape:null,color:"ffffff",friction:0,density:0,restitution:0,class:"polygon"},i=new PIXI.Graphics;s.layer=i,i.interactive=!0,i.lineStyle(0),i.alpha=.5,i.x=0,i.y=e.addBtnSize,t.stage.addChild(i),e.layerList.push(i),i.interactive=!0,i.cleaner=function(){let e=i.getGroup();Object.keys(e.dots).forEach((t=>{e.dots[t].forEach((e=>e.parent.removeChild(e))),e.dots[t].splice(0,1/0)})),e.shape&&(e.shape.parent.removeChild(e.shape),e.shape=null)},i.getIdxNumber=function(t){for(let s=0;s<e.layerList.length;s++)if(e.layerList[s]===i)return t?i:s},i.remove=function(){e.layerList.splice(i.getIdxNumber(),1),i.parent.removeChild(i),e.layerList.length||(e.group=null),d(e.layerList,e),e.editor.active(e),e.layerList[0]?.setFocus()},i.setColor=function(t){s.color=t,t=Number("0x"+t),i.clear(),i.beginFill(t,1),i.drawCircle(0,0,e.addBtnSize),i.endFill(),s.dots[s.class].forEach((s=>{s.clear(),s.beginFill(t,1),s.drawCircle(0,0,e.dotsize),s.endFill()}));const{group:n}=e;n&&n.shape&&n.shape.redrawPoly()},i.setJSON=function(t){Object.keys(t).forEach((e=>{["dots","shape","layer"].includes(e)||(s[e]=t[e])}));let n=JSON.stringify(i.getJSON(),void 0,3);e.editor.getEditor("layer").value=n,Object.keys(s.dots).forEach((e=>{s.dots[e].forEach((e=>{e.interactive=!1,e.alpha=0}))})),s.dots[s.class].forEach((e=>{e.interactive=!0,e.alpha=1})),i.setColor(t.color),p(e,e.group)},i.getGroup=function(){return s},i.loseFocus=function(){i.alpha=.5},i.setFocus=function(){e.layerList.forEach((e=>{e.loseFocus();let t=e.getGroup();t.active=!1,t.shape&&(t.shape.alpha=.5),t.dots[t.class].forEach((e=>e.alpha=0))})),i.alpha=1,e.group=s,s.active=!0,s.shape&&(s.shape.alpha=1),s.dots[s.class].forEach((e=>e.alpha=1)),i.setJSON(i.getJSON()),e.editor.turn("layer"),e.editor.selectShape(i.getJSON().class)},i.getJSON=function(){let e={...s};return["dots","shape","layer","active"].forEach((t=>delete e[t])),e},h(i,["mousedown","touchstart"],(function(e){i.setFocus()})),i.emit("mousedown"),d(e.layerList,e),i.setJSON(s),e.editor.active(e),m(e)}const{getActiveObj:y,reAlignLayers:g,setDotPos:x,setEvent:f}=i;function m(e){let t=e.layerList.map((e=>{let t=e.getGroup(),s=Object.keys(t.dots),i={};return s.forEach((e=>{let s=t.dots[e].map((e=>({x:e.x,y:e.y})));i[e]=s})),{dots:i,...e.getJSON()}}));return t={layers:t,pivotpoint:e.centerdot.getPosition(),...JSON.parse(e.editor.getEditor("general").value)},t=JSON.stringify(t),history.replaceState(null,null,location.pathname+"#"+encodeURIComponent(t)),console.log(Math.random(),"saved"),t}function v(e,t){const{group:s}=e;if(t=JSON.parse(t)){{let s={...t};delete s.layers,delete s.pivotpoint,e.editor.getEditor("general").value=JSON.stringify(s,void 0,3)}e.centerdot.setPosition(t.pivotpoint),t.layers.forEach((t=>{u(e);let s=y(e);s.setJSON(t),["polygon","rect","circle"].forEach((i=>{s.getGroup().class=i,t.dots[i].forEach((t=>c(t,e)))})),e.editor.selectShape(t.class)})),e.editor.turn("layer"),m(e)}}const{getActiveObj:b,reAlignLayers:w,setDotPos:E,setEvent:A}=i,{reAlignLayers:L,setEvent:O}=i,{getActiveObj:S,reAlignLayers:C,setDotPos:P,setEvent:k}=i,{getActiveObj:N,reAlignLayers:I,setDotPos:J,setEvent:F}=i,{getActiveObj:G,reAlignLayers:j,setDotPos:D,setEvent:z}=i,{makeADot:B,getActiveObj:R,reAlignLayers:T,setDotPos:X,setEvent:_}=i,M={term:30,addBtnSize:20,layerList:[],dotsize:10,group:null};window.addEventListener("keydown",(function(e){if("Delete"===e.key){let e=R(M).getGroup(),t=e.dots[e.class],s=t.indexOf(M.lastChooseOne);if(s>-1){let i=t.splice(s,1)[0];i.parent.removeChild(i),e&&e.shape&&e.shape.redrawPoly()}}})),window.addEventListener("load",(function(){document.body.innerHTML="",document.body.style.margin="0px",M.app=new PIXI.Application({width:window.innerWidth,height:window.innerHeight,antialias:!0,resolution:window.devicePixelRatio,autoDensity:!0});let s,{width:i,height:n}=M.app.screen;document.body.appendChild(M.app.view),M.app.stage.sortableChildren=!0,M.addButton=function(e){let{app:t}=e,s=e.addBtnSize,i=new PIXI.Graphics;return i.zIndex=1,i.interactive=!0,i.lineStyle(0),i.alpha=.5,i.beginFill(65535,1),i.drawCircle(0,0,s),i.endFill(),i.x=s,i.y=s,t.stage.addChild(i),O(i,["mousedown","touchstart"],(function(){u(e)})),i}(M),function(e,s,i){let{app:n}=e,o=0;for(;;){o+=e.term;let a=new t;if(a.alpha=.5,a.tint=61440,a.thickness=.5,a.ax=0,a.ay=o,a.bx=s,a.by=o,n.stage.addChild(a),o>i)break}for(o=0;;){o+=e.term;let a=new t;if(a.alpha=.5,a.tint=61440,a.thickness=.5,a.ax=o,a.ay=0,a.bx=o,a.by=i,n.stage.addChild(a),o>s)break}}(M,i,n),function(t,s,i){let n=new e;n.width=s,n.height=i,n.alpha=0,t.app.stage.addChild(n),n.interactive=!0,k(n,["mousedown","touchstart"],(function(e){const{group:s}=t;if(s||t.addButton.emit("mousedown"),s){if("circle"===s.class&&s.dots[s.class].length>=2)return;if("rect"===s.class&&s.dots[s.class].length>=2)return}c(e.data.getLocalPosition(this.parent),t)}))}(M,i,n),M.editor=function(e){let t={},s={},i={},n={},o=document.createElement("div");o.style.position="fixed",o.style.right="0px",o.style.top="0px",o.style.padding="10px",document.body.appendChild(o);let a=document.createElement("div");function l(){let e=document.createElement("button");return e.style.color="#ffffff",e.style.background="#000000",e.style.border="1px solid green",e.style.padding="10px",e}o.appendChild(a);{let n="general",c=l();c.innerText="General",a.appendChild(c),c.addEventListener("click",(e=>r(n))),i[n]=c;let d=document.createElement("div");o.append(d);let h=document.createElement("textarea");h.style.width="200px",h.style.height="200px",d.append(h),h.addEventListener("keyup",(function(){})),t[n]=h,s[n]=d;{let t=document.createElement("div");t.innerText="Save & Export as JSON",t.style.cursor="pointer",t.style.color="white",t.style.padding="5px",t.style.border="1px solid #777",t.style.textAlign="center",t.style.background="#000",d.appendChild(t),t.addEventListener("click",(t=>{!function(e){const t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}(m(e)),Swal.fire("Saved and Copied to your clipboard")}))}{let t=document.createElement("div");t.innerText="Load JSON",t.style.cursor="pointer",t.style.color="white",t.style.padding="5px",t.style.border="1px solid #777",t.style.textAlign="center",t.style.background="#000",d.appendChild(t),t.addEventListener("click",(t=>{let s=prompt("JSON을 넣어주세요");try{if(s){for(JSON.parse(s);N(e);)N(e)?.cleaner(),N(e)?.remove();v(e,s)}}catch(t){}}))}}{let c="layer",d=l();d.innerText="Layer",a.appendChild(d),d.addEventListener("click",(e=>r(c))),i[c]=d;let h=document.createElement("div");o.append(h);let p=document.createElement("textarea");p.style.width="200px",p.style.height="200px",h.append(p),p.addEventListener("keyup",(function(){try{let t=JSON.parse(this.value);N(e).setJSON(t),p.style.color=""}catch(e){p.style.color="red"}})),t[c]=p,s[c]=h,["polygon","circle","rect"].forEach((t=>{let s=document.createElement("div");s.classList.add("type"),n[t]=s,s.innerText=t,s.style.cursor="pointer",s.style.color="white",s.style.padding="5px",s.style.border="0px solid red",h.appendChild(s),s.addEventListener("click",(i=>{[...h.children].filter((e=>e.classList.contains("type"))).forEach((e=>e.style.background=""));const n=N(e).getGroup();n.class=t,N(e).setJSON(n),s.style.background="green",m(e)}))}));{let t=document.createElement("div");t.innerText="Clear Shapes",t.style.cursor="pointer",t.style.color="white",t.style.padding="5px",t.style.border="1px solid #777",t.style.textAlign="center",t.style.background="#000",h.appendChild(t),t.addEventListener("click",(t=>{N(e)?.cleaner(),m(e)}))}{let t=document.createElement("div");t.innerText="Remove Layer",t.style.cursor="pointer",t.style.color="red",t.style.padding="5px",t.style.border="1px solid #770000",t.style.textAlign="center",t.style.background="#000",h.appendChild(t),t.addEventListener("click",(t=>{N(e)?.cleaner(),N(e)?.remove(),m(e)}))}}function r(t){(e.group||"general"===t)&&(Object.values(s).forEach((e=>e.style.display="none")),Object.values(i).forEach((e=>e.style.opacity="0.3")),s[t].style.display="block",i[t].style.opacity="1")}return r("general"),{active:function(e){r("layer"),e.group||r("general")},getEditor:function(e){return t[e]},turn:r,selectShape:function(e){n[e].click()}}}(M),M.centerdot=new class{getGraphic(){return this.graphic}getPosition(){let e=this.getGraphic();return{x:e.x,y:e.y}}setPosition({x:e,y:t}){let s=this.getGraphic();s.x=e,s.y=t,this.setLinePos()}setLinePos(){let e=this.line_verti,t=this.line_hori,s=this.getGraphic(),i=this.width,n=this.height;t.ax=s.x,t.ay=0,t.bx=s.x,t.by=n,e.ax=0,e.ay=s.y,e.bx=i,e.by=s.y}constructor({global:e,width:s,height:i}){let n=this,{app:o,group:a}=e;this.width=s,this.height=i;let l=new PIXI.Graphics;l.zIndex=1,this.graphic=l,l.lineStyle(0),l.alpha=.5,l.beginFill(16777215,1),l.drawRect(-10,-10,20,20),l.endFill(),o.stage.addChild(l),E.bind(l)({x:s/2,y:i/2,group:a,global:e});let r=new t;r.tint=16777215,r.thickness=1,r.ax=0,r.ay=0,r.bx=0,r.by=0,o.stage.addChild(r);let c=new t;c.tint=16777215,c.thickness=1,c.ax=0,c.ay=0,c.bx=0,c.by=0,o.stage.addChild(c),this.line_verti=c,this.line_hori=r,this.setLinePos();let d=null,h=null,p=null;A(l,["mousedown","touchstart"],(function(e){this.data=e.data,this.dragging=!0;const t=this.data.getLocalPosition(this.parent);d=t,h={x:0,y:0},p={x:l.x,y:l.y}})),A(l,["mousemove","touchmove"],(function(t){if(this.dragging){const t=this.data.getLocalPosition(this.parent);let s={x:t.x-d.x,y:t.y-d.y};h.x+=s.x,h.y+=s.y,d=t,E.bind(l)({x:h.x+p.x,y:h.y+p.y,group:a,global:e}),n.setLinePos()}})),A(l,["mouseup","mouseupoutside","touchend","touchendoutside"],(function(){this.dragging=!1,this.data=null,d=null,h=null,m(e)}))}}({global:M,width:i,height:n}),M.editor.getEditor("general").value=JSON.stringify({scale:M.term},void 0,3);try{s=JSON.parse(decodeURIComponent(location.hash.substring(1,1/0))),v(M,JSON.stringify(s))}catch(e){v(M,localStorage.getItem("working"))}M.editor.active(M)}))})();
//# sourceMappingURL=bundle.js.map