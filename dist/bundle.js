(()=>{"use strict";class e extends PIXI.Sprite{constructor(){super(PIXI.Texture.from("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII="))}}class t extends e{spec={};constructor(){super(),this.anchor.y=.5,this.axis=.5,this.thickness=1}set thickness(e){this.height=e}get thickness(){return this.height}set axis(e){this.anchor.x=e}get axis(){return this.anchor.x}set ax(e){this.spec.ax=e,this.calcpos()}get ax(){return this.spec.ax??0}set ay(e){this.spec.ay=e,this.calcpos()}get ay(){return this.spec.ay??0}set bx(e){this.spec.bx=e,this.calcpos()}get bx(){return this.spec.bx??0}set by(e){this.spec.by=e,this.calcpos()}get by(){return this.spec.by??0}get length(){let e=this.ax-this.bx,t=this.ay-this.by;return Math.sqrt(e*e+t*t)}calcpos(){this.width=this.length,this.x=this.bx-(this.bx-this.ax)*(1-this.anchor.x),this.y=this.by-(this.by-this.ay)*(1-this.anchor.x),this.rotation=Math.atan2(this.by-this.ay,this.bx-this.ax)}}function s(e,t,s){e.interactive=!0,[t].flat(1/0).forEach((t=>e.on(t,s)))}function i({x:e,y:t,redraw:s,group:i,global:n}){let a=i&&i.dots[i.class].indexOf(this),o=n.term,l=this,r=e,c=t,d=.5*o<r%o,h=.5*o<c%o,p=JSON.stringify([l.position.x,l.position.y]),u=r-r%o+(d?o:0),y=c-c%o+(h?o:0),g=!0;if(null!==a&&"rect"===i.class){let e=i.dots[i.class].map((e=>({x:e.x,y:e.y})));1!==a||e[0].x-u<0&&e[0].y-y<0||(g=!1)}return g&&(l.position.x=u,l.position.y=y),s&&i&&i.shape&&i.shape.redrawPoly(),p===JSON.stringify([l.position.x,l.position.y])}function n(e,t){t&&("circle"!==t.class&&"rect"!==t.class||2===t.dots[t.class].length&&(t.dots[t.class][0].interactive=!1,t.dots[t.class][0].alpha=0))}let a={setEvent:s,setDotPos:i,reAlignLayers:function(e,t){e.forEach(((e,s)=>{e.x=3*t.addBtnSize+40*s}))},getActiveObj:function(e){return e.layerList.filter((e=>e.getGroup().active))[0]},makeADot:function(e,t){let{app:a,group:o}=t;if(!o)return;if(!o.shape){let e=new PIXI.Graphics;e.redrawPoly=function(){const t=e.group;if(t&&t.shape){if(t.shape.clear(),t.shape.lineStyle(4,Number("0x"+t.color)),t.shape.beginFill(Number("0x"+t.color),.5),"polygon"===t.class&&t.shape.drawPolygon(t.dots[t.class].map((e=>[e.x,e.y])).flat(1/0)),"circle"===t.class){let e=t.dots[t.class].map((e=>({x:e.x,y:e.y})));if(2===e.length){let s=ksttool.math.get_distance_between_two_point(e[0],e[1]);t.shape.drawCircle(e[0].x,e[0].y,s)}}if("rect"===t.class){let e=t.dots[t.class].map((e=>({x:e.x,y:e.y})));2===e.length&&t.shape.drawRect(e[0].x,e[0].y,e[1].x-e[0].x,e[1].y-e[0].y)}t.shape.endFill()}},o.shape=e,o.shape.group=o,o.shape.interactive=!0,a.stage.addChild(o.shape);let t=null,i=null,n=null;const l=function(s){if(e.group.layer.emit("mousedown"),!this.group.active)return;this.data=s.data,this.dragging=!0;const a=this.data.getLocalPosition(this.parent);t=a,i={x:0,y:0},n=o.dots[o.class].map((e=>({x:e.x,y:e.y})))},r=function(){this.dragging=!1,this.data=null,t=null,i=null,n=null},c=function(e){if(this.dragging){const e=this.data.getLocalPosition(this.parent);let s={x:e.x-t.x,y:e.y-t.y};i.x+=s.x,i.y+=s.y,t=e,o.dots[o.class].forEach(((e,t)=>{e.onDragMove({x:i.x+n[t].x,y:i.y+n[t].y},!0)}))}};s(o.shape,["mousedown","touchstart"],l),s(o.shape,["mousemove","touchmove"],c),s(o.shape,["mouseup","mouseupoutside","touchend","touchendoutside"],r)}let l=new PIXI.Graphics;function r(e,s){let n=e&&"InteractionEvent"!==e.constructor.name;if(n||this.dragging){let a=o.dots[o.class].indexOf(this);if(!s&&0===a&&("rect"===o.class||"circle"===o.class)&&2===o.dots[o.class].length)return;const l=n?e:this.data.getLocalPosition(this.parent);i.bind(this)({...l,redraw:!0,group:o,global:t})}}l.interactive=!0,l.lineStyle(0),l.beginFill(Number("0x"+o.color),1),l.drawCircle(0,0,t.dotsize),l.endFill(),l.group=o,a.stage.addChild(l),o.dots[o.class].push(l),i.bind(l)({...e,redraw:!0,group:o,global:t}),s(l,["mousedown","touchstart"],(function(e){l.group.layer.emit("mousedown"),this.group.active&&(this.data=e.data,this.dragging=!0)})),s(l,["mousemove","touchmove"],r),s(l,["mouseup","mouseupoutside","touchend","touchendoutside"],(function(){this.dragging=!1,this.data=null})),l.onDragMove=r,n(0,o)},setFirstInvisible:n};const o=a,{makeADot:l,getActiveObj:r,reAlignLayers:c,setDotPos:d,setEvent:h}=o,{reAlignLayers:p,setEvent:u,setFirstInvisible:y}=o;function g(e){let{app:t}=e,s={dots:{polygon:[],circle:[],rect:[]},shape:null,color:"ffffff",friction:0,density:0,restitution:0,class:"polygon"},i=new PIXI.Graphics;s.layer=i,i.interactive=!0,i.lineStyle(0),i.alpha=.5,i.x=0,i.y=e.addBtnSize,t.stage.addChild(i),e.layerList.push(i),i.interactive=!0,i.cleaner=function(){let e=i.getGroup();Object.keys(e.dots).forEach((t=>{e.dots[t].forEach((e=>e.parent.removeChild(e))),e.dots[t].splice(0,1/0)})),e.shape&&(e.shape.parent.removeChild(e.shape),e.shape=null)},i.getIdxNumber=function(t){for(let s=0;s<e.layerList.length;s++)if(e.layerList[s]===i)return t?i:s},i.remove=function(){e.layerList.splice(i.getIdxNumber(),1),i.parent.removeChild(i),e.layerList.length||(e.group=null),p(e.layerList,e),e.editor.active(e),e.layerList[0]?.setFocus()},i.setColor=function(t){s.color=t,t=Number("0x"+t),i.clear(),i.beginFill(t,1),i.drawCircle(0,0,e.addBtnSize),i.endFill(),s.dots[s.class].forEach((s=>{s.clear(),s.beginFill(t,1),s.drawCircle(0,0,e.dotsize),s.endFill()}));const{group:n}=e;n&&n.shape&&n.shape.redrawPoly()},i.setJSON=function(t){Object.keys(t).forEach((e=>{["dots","shape","layer"].includes(e)||(s[e]=t[e])}));let n=JSON.stringify(i.getJSON(),void 0,3);e.editor.getEditor("layer").value=n,Object.keys(s.dots).forEach((e=>{s.dots[e].forEach((e=>{e.interactive=!1,e.alpha=0}))})),s.dots[s.class].forEach((e=>{e.interactive=!0,e.alpha=1})),i.setColor(t.color),y(e,e.group)},i.getGroup=function(){return s},i.loseFocus=function(){i.alpha=.5},i.setFocus=function(){e.layerList.forEach((e=>{e.loseFocus();let t=e.getGroup();t.active=!1,t.shape&&(t.shape.alpha=.5),t.dots[t.class].forEach((e=>e.alpha=0))})),i.alpha=1,e.group=s,s.active=!0,s.shape&&(s.shape.alpha=1),s.dots[s.class].forEach((e=>e.alpha=1)),i.setJSON(i.getJSON()),e.editor.turn("layer"),e.editor.selectShape(i.getJSON().class)},i.getJSON=function(){let e={...s};return["dots","shape","layer","active"].forEach((t=>delete e[t])),e},u(i,["mousedown","touchstart"],(function(e){i.setFocus()})),i.emit("mousedown"),p(e.layerList,e),i.setJSON(s),e.editor.active(e)}const{reAlignLayers:x,setEvent:f}=o,{makeADot:m,getActiveObj:b,reAlignLayers:v,setDotPos:w,setEvent:E}=o,{makeADot:A,getActiveObj:S,reAlignLayers:L,setDotPos:O,setEvent:C}=o;function k(e,t){const{group:s}=e;if(t=JSON.parse(t)){{let s={...t};delete s.layers,delete s.pivotpoint,e.editor.getEditor("general").value=JSON.stringify(s,void 0,3)}e.centerdot.setPosition(t.pivotpoint),t.layers.forEach((t=>{g(e);let s=S(e);s.setJSON(t),["polygon","rect","circle"].forEach((i=>{s.getGroup().class=i,t.dots[i].forEach((t=>A(t,e)))})),e.editor.selectShape(t.class)})),e.editor.turn("layer")}}const{makeADot:P,getActiveObj:N,reAlignLayers:I,setDotPos:J,setEvent:F}=o,{makeADot:G,getActiveObj:D,reAlignLayers:j,setDotPos:z,setEvent:B}=o,{makeADot:T,getActiveObj:R,reAlignLayers:X,setDotPos:_,setEvent:M}=o,U={term:30,addBtnSize:20,layerList:[],dotsize:10,group:null};window.addEventListener("load",(function(){document.body.innerHTML="",document.body.style.margin="0px",U.app=new PIXI.Application({width:window.innerWidth,height:window.innerHeight,antialias:!0,resolution:window.devicePixelRatio,autoDensity:!0});let s,{width:i,height:n}=U.app.screen;document.body.appendChild(U.app.view),U.app.stage.sortableChildren=!0,U.addButton=function(e){let{app:t}=e,s=e.addBtnSize,i=new PIXI.Graphics;return i.zIndex=1,i.interactive=!0,i.lineStyle(0),i.alpha=.5,i.beginFill(65535,1),i.drawCircle(0,0,s),i.endFill(),i.x=s,i.y=s,t.stage.addChild(i),f(i,["mousedown","touchstart"],(function(){g(e)})),i}(U),function(e,s,i){let{app:n}=e,a=0;for(;;){a+=e.term;let o=new t;if(o.alpha=.5,o.tint=61440,o.thickness=.5,o.ax=0,o.ay=a,o.bx=s,o.by=a,n.stage.addChild(o),a>i)break}for(a=0;;){a+=e.term;let o=new t;if(o.alpha=.5,o.tint=61440,o.thickness=.5,o.ax=a,o.ay=0,o.bx=a,o.by=i,n.stage.addChild(o),a>s)break}}(U,i,n),function(t,s,i){let n=new e;n.width=s,n.height=i,n.alpha=0,t.app.stage.addChild(n),n.interactive=!0,E(n,["mousedown","touchstart"],(function(e){const{group:s}=t;if(s||t.addButton.emit("mousedown"),s){if("circle"===s.class&&s.dots[s.class].length>=2)return;if("rect"===s.class&&s.dots[s.class].length>=2)return}m(e.data.getLocalPosition(this.parent),t)}))}(U,i,n),U.editor=function(e){let t={},s={},i={},n={},a=document.createElement("div");a.style.position="fixed",a.style.right="0px",a.style.top="0px",a.style.padding="10px",document.body.appendChild(a);let o=document.createElement("div");function l(){let e=document.createElement("button");return e.style.color="#ffffff",e.style.background="#000000",e.style.border="1px solid green",e.style.padding="10px",e}a.appendChild(o);{let n="general",c=l();c.innerText="General",o.appendChild(c),c.addEventListener("click",(e=>r(n))),i[n]=c;let d=document.createElement("div");a.append(d);let h=document.createElement("textarea");h.style.width="200px",h.style.height="200px",d.append(h),h.addEventListener("keyup",(function(){})),t[n]=h,s[n]=d;{let t=document.createElement("div");t.innerText="Save & Export as JSON",t.style.cursor="pointer",t.style.color="white",t.style.padding="5px",t.style.border="1px solid #777",t.style.textAlign="center",t.style.background="#000",d.appendChild(t),t.addEventListener("click",(t=>{!function(e){const t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}(function(e){let t=e.layerList.map((e=>{let t=e.getGroup(),s=Object.keys(t.dots),i={};return s.forEach((e=>{let s=t.dots[e].map((e=>({x:e.x,y:e.y})));i[e]=s})),{dots:i,...e.getJSON()}}));return t={layers:t,pivotpoint:e.centerdot.getPosition(),...JSON.parse(e.editor.getEditor("general").value)},t=JSON.stringify(t),localStorage.setItem("working",t),t}(e)),Swal.fire("Saved and Copied to your clipboard")}))}{let t=document.createElement("div");t.innerText="Load JSON",t.style.cursor="pointer",t.style.color="white",t.style.padding="5px",t.style.border="1px solid #777",t.style.textAlign="center",t.style.background="#000",d.appendChild(t),t.addEventListener("click",(t=>{let s=prompt("JSON을 넣어주세요");try{if(s){for(JSON.parse(s);N(e);)N(e)?.cleaner(),N(e)?.remove();k(e,s)}}catch(t){}}))}}{let c="layer",d=l();d.innerText="Layer",o.appendChild(d),d.addEventListener("click",(e=>r(c))),i[c]=d;let h=document.createElement("div");a.append(h);let p=document.createElement("textarea");p.style.width="200px",p.style.height="200px",h.append(p),p.addEventListener("keyup",(function(){try{let t=JSON.parse(this.value);N(e).setJSON(t),p.style.color=""}catch(e){p.style.color="red"}})),t[c]=p,s[c]=h,["polygon","circle","rect"].forEach((t=>{let s=document.createElement("div");s.classList.add("type"),n[t]=s,s.innerText=t,s.style.cursor="pointer",s.style.color="white",s.style.padding="5px",s.style.border="0px solid red",h.appendChild(s),s.addEventListener("click",(i=>{[...h.children].filter((e=>e.classList.contains("type"))).forEach((e=>e.style.background=""));const n=N(e).getGroup();n.class=t,N(e).setJSON(n),s.style.background="green"}))}));{let t=document.createElement("div");t.innerText="Clear Shapes",t.style.cursor="pointer",t.style.color="white",t.style.padding="5px",t.style.border="1px solid #777",t.style.textAlign="center",t.style.background="#000",h.appendChild(t),t.addEventListener("click",(t=>{N(e)?.cleaner()}))}{let t=document.createElement("div");t.innerText="Remove Layer",t.style.cursor="pointer",t.style.color="red",t.style.padding="5px",t.style.border="1px solid #770000",t.style.textAlign="center",t.style.background="#000",h.appendChild(t),t.addEventListener("click",(t=>{N(e)?.cleaner(),N(e)?.remove()}))}}function r(t){(e.group||"general"===t)&&(Object.values(s).forEach((e=>e.style.display="none")),Object.values(i).forEach((e=>e.style.opacity="0.3")),s[t].style.display="block",i[t].style.opacity="1")}return r("general"),{active:function(e){r("layer"),e.group||r("general")},getEditor:function(e){return t[e]},turn:r,selectShape:function(e){n[e].click()}}}(U),U.centerdot=new class{getGraphic(){return this.graphic}getPosition(){let e=this.getGraphic();return{x:e.x,y:e.y}}setPosition({x:e,y:t}){let s=this.getGraphic();s.x=e,s.y=t,this.setLinePos()}setLinePos(){let e=this.line_verti,t=this.line_hori,s=this.getGraphic(),i=this.width,n=this.height;t.ax=s.x,t.ay=0,t.bx=s.x,t.by=n,e.ax=0,e.ay=s.y,e.bx=i,e.by=s.y}constructor({global:e,width:s,height:i}){let n=this,{app:a,group:o}=e;this.width=s,this.height=i;let l=new PIXI.Graphics;l.zIndex=1,this.graphic=l,l.lineStyle(0),l.alpha=.5,l.beginFill(16777215,1),l.drawRect(-10,-10,20,20),l.endFill(),a.stage.addChild(l),d.bind(l)({x:s/2,y:i/2,group:o,global:e});let r=new t;r.tint=16777215,r.thickness=1,r.ax=0,r.ay=0,r.bx=0,r.by=0,a.stage.addChild(r);let c=new t;c.tint=16777215,c.thickness=1,c.ax=0,c.ay=0,c.bx=0,c.by=0,a.stage.addChild(c),this.line_verti=c,this.line_hori=r,this.setLinePos();let p=null,u=null,y=null;h(l,["mousedown","touchstart"],(function(e){this.data=e.data,this.dragging=!0;const t=this.data.getLocalPosition(this.parent);p=t,u={x:0,y:0},y={x:l.x,y:l.y}})),h(l,["mousemove","touchmove"],(function(t){if(this.dragging){const t=this.data.getLocalPosition(this.parent);let s={x:t.x-p.x,y:t.y-p.y};u.x+=s.x,u.y+=s.y,p=t,d.bind(l)({x:u.x+y.x,y:u.y+y.y,group:o,global:e}),n.setLinePos()}})),h(l,["mouseup","mouseupoutside","touchend","touchendoutside"],(function(){this.dragging=!1,this.data=null,p=null,u=null}))}}({global:U,width:i,height:n}),U.editor.getEditor("general").value=JSON.stringify({scale:U.term},void 0,3);try{s=JSON.parse(decodeURIComponent(location.hash.substring(1,1/0))),k(U,JSON.stringify(s))}catch(e){k(U,localStorage.getItem("working"))}U.editor.active(U)}))})();
//# sourceMappingURL=bundle.js.map