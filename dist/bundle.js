(()=>{"use strict";class e extends PIXI.Sprite{constructor(){super(PIXI.Texture.from("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII="))}}class t extends e{spec={};constructor(){super(),this.anchor.y=.5,this.axis=.5,this.thickness=1}set thickness(e){this.height=e}get thickness(){return this.height}set axis(e){this.anchor.x=e}get axis(){return this.anchor.x}set ax(e){this.spec.ax=e,this.calcpos()}get ax(){return this.spec.ax??0}set ay(e){this.spec.ay=e,this.calcpos()}get ay(){return this.spec.ay??0}set bx(e){this.spec.bx=e,this.calcpos()}get bx(){return this.spec.bx??0}set by(e){this.spec.by=e,this.calcpos()}get by(){return this.spec.by??0}get length(){let e=this.ax-this.bx,t=this.ay-this.by;return Math.sqrt(e*e+t*t)}calcpos(){this.width=this.length,this.x=this.bx-(this.bx-this.ax)*(1-this.anchor.x),this.y=this.by-(this.by-this.ay)*(1-this.anchor.x),this.rotation=Math.atan2(this.by-this.ay,this.bx-this.ax)}}function i(e,t,i){e.interactive=!0,[t].flat(1/0).forEach((t=>e.on(t,i)))}function s({x:e,y:t,redraw:i,group:s,global:a}){let n=s&&s.dots[s.class].indexOf(this),o=a.term,l=this,r=e,c=t,d=.5*o<r%o,h=.5*o<c%o,p=JSON.stringify([l.position.x,l.position.y]),u=r-r%o+(d?o:0),g=c-c%o+(h?o:0),y=!0;if(null!==n&&"rect"===s.class){let e=s.dots[s.class].map((e=>({x:e.x,y:e.y})));1!==n||e[0].x-u<0&&e[0].y-g<0||(y=!1)}return y&&(l.position.x=u,l.position.y=g),i&&s&&s.shape&&s.shape.redrawPoly(),p===JSON.stringify([l.position.x,l.position.y])}function a(e,t){t&&("circle"!==t.class&&"rect"!==t.class||2===t.dots[t.class].length&&(t.dots[t.class][0].interactive=!1,t.dots[t.class][0].alpha=0))}let n={setEvent:i,setDotPos:s,reAlignLayers:function(e,t){e.forEach(((e,i)=>{e.x=3*t.addBtnSize+40*i}))},getActiveObj:function(e){return e.layerList.filter((e=>e.getGroup().active))[0]},makeADot:function(e,t){let{app:n,group:o}=t;if(!o)return;if(!o.shape){let e=new PIXI.Graphics;e.redrawPoly=function(){const t=e.group;if(t&&t.shape){if(t.shape.clear(),t.shape.lineStyle(4,Number("0x"+t.color)),t.shape.beginFill(Number("0x"+t.color),.5),"polygon"===t.class&&t.shape.drawPolygon(t.dots[t.class].map((e=>[e.x,e.y])).flat(1/0)),"circle"===t.class){let e=t.dots[t.class].map((e=>({x:e.x,y:e.y})));if(2===e.length){let i=ksttool.math.get_distance_between_two_point(e[0],e[1]);t.shape.drawCircle(e[0].x,e[0].y,i)}}if("rect"===t.class){let e=t.dots[t.class].map((e=>({x:e.x,y:e.y})));2===e.length&&t.shape.drawRect(e[0].x,e[0].y,e[1].x-e[0].x,e[1].y-e[0].y)}t.shape.endFill()}},o.shape=e,o.shape.group=o,o.shape.interactive=!0,n.stage.addChild(o.shape);let t=null,s=null,a=null;const l=function(i){if(e.group.layer.emit("mousedown"),!this.group.active)return;this.data=i.data,this.dragging=!0;const n=this.data.getLocalPosition(this.parent);t=n,s={x:0,y:0},a=o.dots[o.class].map((e=>({x:e.x,y:e.y})))},r=function(){this.dragging=!1,this.data=null,t=null,s=null,a=null},c=function(e){if(this.dragging){const e=this.data.getLocalPosition(this.parent);let i={x:e.x-t.x,y:e.y-t.y};s.x+=i.x,s.y+=i.y,t=e,o.dots[o.class].forEach(((e,t)=>{e.onDragMove({x:s.x+a[t].x,y:s.y+a[t].y},!0)}))}};i(o.shape,["mousedown","touchstart"],l),i(o.shape,["mousemove","touchmove"],c),i(o.shape,["mouseup","mouseupoutside","touchend","touchendoutside"],r)}let l=new PIXI.Graphics;function r(e,i){let a=e&&"InteractionEvent"!==e.constructor.name;if(a||this.dragging){let n=o.dots[o.class].indexOf(this);if(!i&&0===n&&("rect"===o.class||"circle"===o.class)&&2===o.dots[o.class].length)return;const l=a?e:this.data.getLocalPosition(this.parent);s.bind(this)({...l,redraw:!0,group:o,global:t})}}l.interactive=!0,l.lineStyle(0),l.beginFill(Number("0x"+o.color),1),l.drawCircle(0,0,t.dotsize),l.endFill(),l.group=o,n.stage.addChild(l),o.dots[o.class].push(l),s.bind(l)({...e,redraw:!0,group:o,global:t}),i(l,["mousedown","touchstart"],(function(e){l.group.layer.emit("mousedown"),this.group.active&&(this.data=e.data,this.dragging=!0)})),i(l,["mousemove","touchmove"],r),i(l,["mouseup","mouseupoutside","touchend","touchendoutside"],(function(){this.dragging=!1,this.data=null})),l.onDragMove=r,a(0,o)},setFirstInvisible:a};const o=n,{makeADot:l,getActiveObj:r,reAlignLayers:c,setDotPos:d,setEvent:h}=o,{reAlignLayers:p,setEvent:u,setFirstInvisible:g}=o;function y(e){let{app:t}=e,i={dots:{polygon:[],circle:[],rect:[]},shape:null,color:"ffffff",friction:0,density:0,restitution:0,class:"polygon"},s=new PIXI.Graphics;i.layer=s,s.interactive=!0,s.lineStyle(0),s.alpha=.5,s.x=0,s.y=e.addBtnSize,t.stage.addChild(s),e.layerList.push(s),s.interactive=!0,s.cleaner=function(){let e=s.getGroup();Object.keys(e.dots).forEach((t=>{e.dots[t].forEach((e=>e.parent.removeChild(e))),e.dots[t].splice(0,1/0)})),e.shape&&(e.shape.parent.removeChild(e.shape),e.shape=null)},s.getIdxNumber=function(t){for(let i=0;i<e.layerList.length;i++)if(e.layerList[i]===s)return t?s:i},s.remove=function(){e.layerList.splice(s.getIdxNumber(),1),s.parent.removeChild(s),e.layerList.length||(e.group=null),p(e.layerList,e),e.editor.active(e),e.layerList[0]?.setFocus()},s.setColor=function(t){i.color=t,t=Number("0x"+t),s.clear(),s.beginFill(t,1),s.drawCircle(0,0,e.addBtnSize),s.endFill(),i.dots[i.class].forEach((i=>{i.clear(),i.beginFill(t,1),i.drawCircle(0,0,e.dotsize),i.endFill()}));const{group:a}=e;a&&a.shape&&a.shape.redrawPoly()},s.setJSON=function(t){Object.keys(t).forEach((e=>{["dots","shape","layer"].includes(e)||(i[e]=t[e])}));let a=JSON.stringify(s.getJSON(),void 0,3);e.editor.getEditor("layer").value=a,Object.keys(i.dots).forEach((e=>{i.dots[e].forEach((e=>{e.interactive=!1,e.alpha=0}))})),i.dots[i.class].forEach((e=>{e.interactive=!0,e.alpha=1})),s.setColor(t.color),g(e,e.group)},s.getGroup=function(){return i},s.loseFocus=function(){s.alpha=.5},s.setFocus=function(){e.layerList.forEach((e=>{e.loseFocus();let t=e.getGroup();t.active=!1,t.shape&&(t.shape.alpha=.5),t.dots[t.class].forEach((e=>e.alpha=0))})),s.alpha=1,e.group=i,i.active=!0,i.shape&&(i.shape.alpha=1),i.dots[i.class].forEach((e=>e.alpha=1)),s.setJSON(s.getJSON()),e.editor.turn("layer"),e.editor.selectShape(s.getJSON().class)},s.getJSON=function(){let e={...i};return["dots","shape","layer","active"].forEach((t=>delete e[t])),e},u(s,["mousedown","touchstart"],(function(e){s.setFocus()})),s.emit("mousedown"),p(e.layerList,e),s.setJSON(i),e.editor.active(e)}const{reAlignLayers:x,setEvent:f}=o,{makeADot:m,getActiveObj:b,reAlignLayers:v,setDotPos:w,setEvent:E}=o,{makeADot:A,getActiveObj:L,reAlignLayers:S,setDotPos:C,setEvent:k}=o;const{makeADot:O,getActiveObj:P,reAlignLayers:I,setDotPos:N,setEvent:J}=o,{makeADot:F,getActiveObj:G,reAlignLayers:D,setDotPos:j,setEvent:z}=o,{makeADot:B,getActiveObj:T,reAlignLayers:X,setDotPos:_,setEvent:R}=o,M={term:30,addBtnSize:20,layerList:[],dotsize:10,group:null};window.addEventListener("load",(function(){document.body.innerHTML="",document.body.style.margin="0px",M.app=new PIXI.Application({width:window.innerWidth,height:window.innerHeight,antialias:!0,resolution:window.devicePixelRatio,autoDensity:!0});let{width:i,height:s}=M.app.screen;document.body.appendChild(M.app.view),M.app.stage.sortableChildren=!0,M.addButton=function(e){let{app:t}=e,i=e.addBtnSize,s=new PIXI.Graphics;return s.zIndex=1,s.interactive=!0,s.lineStyle(0),s.alpha=.5,s.beginFill(65535,1),s.drawCircle(0,0,i),s.endFill(),s.x=i,s.y=i,t.stage.addChild(s),f(s,["mousedown","touchstart"],(function(){y(e)})),s}(M),function(e,i,s){let{app:a}=e,n=0;for(;;){n+=e.term;let o=new t;if(o.alpha=.5,o.tint=61440,o.thickness=.5,o.ax=0,o.ay=n,o.bx=i,o.by=n,a.stage.addChild(o),n>s)break}for(n=0;;){n+=e.term;let o=new t;if(o.alpha=.5,o.tint=61440,o.thickness=.5,o.ax=n,o.ay=0,o.bx=n,o.by=s,a.stage.addChild(o),n>i)break}}(M,i,s),function(t,i,s){let a=new e;a.width=i,a.height=s,a.alpha=0,t.app.stage.addChild(a),a.interactive=!0,E(a,["mousedown","touchstart"],(function(e){const{group:i}=t;if(i||t.addButton.emit("mousedown"),i){if("circle"===i.class&&i.dots[i.class].length>=2)return;if("rect"===i.class&&i.dots[i.class].length>=2)return}m(e.data.getLocalPosition(this.parent),t)}))}(M,i,s),M.editor=function(e){let t={},i={},s={},a={},n=document.createElement("div");n.style.position="fixed",n.style.right="0px",n.style.top="0px",n.style.padding="10px",document.body.appendChild(n);let o=document.createElement("div");function l(){let e=document.createElement("button");return e.style.color="#ffffff",e.style.background="#000000",e.style.border="1px solid green",e.style.padding="10px",e}n.appendChild(o);{let a="general",c=l();c.innerText="General",o.appendChild(c),c.addEventListener("click",(e=>r(a))),s[a]=c;let d=document.createElement("div");n.append(d);let h=document.createElement("textarea");h.style.width="200px",h.style.height="200px",d.append(h),h.addEventListener("keyup",(function(){})),t[a]=h,i[a]=d;{let t=document.createElement("div");t.innerText="Save & Export",t.style.cursor="pointer",t.style.color="white",t.style.padding="5px",t.style.border="1px solid #777",t.style.textAlign="center",t.style.background="#000",d.appendChild(t),t.addEventListener("click",(t=>{!function(e){const t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}(function(e){let t=e.layerList.map((e=>{let t=e.getGroup(),i=Object.keys(t.dots),s={};return i.forEach((e=>{let i=t.dots[e].map((e=>({x:e.x,y:e.y})));s[e]=i})),{dots:s,...e.getJSON()}}));return t={layers:t,pivotpoint:e.centerdot.getPosition(),...JSON.parse(e.editor.getEditor("general").value)},t=JSON.stringify(t),localStorage.setItem("working",t),t}(e)),Swal.fire("Saved and Copied to your clipboard")}))}}{let c="layer",d=l();d.innerText="Layer",o.appendChild(d),d.addEventListener("click",(e=>r(c))),s[c]=d;let h=document.createElement("div");n.append(h);let p=document.createElement("textarea");p.style.width="200px",p.style.height="200px",h.append(p),p.addEventListener("keyup",(function(){try{let t=JSON.parse(this.value);P(e).setJSON(t),p.style.color=""}catch(e){p.style.color="red"}})),t[c]=p,i[c]=h,["polygon","circle","rect"].forEach((t=>{let i=document.createElement("div");i.classList.add("type"),a[t]=i,i.innerText=t,i.style.cursor="pointer",i.style.color="white",i.style.padding="5px",i.style.border="0px solid red",h.appendChild(i),i.addEventListener("click",(s=>{[...h.children].filter((e=>e.classList.contains("type"))).forEach((e=>e.style.background=""));const a=P(e).getGroup();a.class=t,P(e).setJSON(a),i.style.background="green"}))}));{let t=document.createElement("div");t.innerText="Clear Shapes",t.style.cursor="pointer",t.style.color="white",t.style.padding="5px",t.style.border="1px solid #777",t.style.textAlign="center",t.style.background="#000",h.appendChild(t),t.addEventListener("click",(t=>{P(e)?.cleaner()}))}{let t=document.createElement("div");t.innerText="Remove Layer",t.style.cursor="pointer",t.style.color="red",t.style.padding="5px",t.style.border="1px solid #770000",t.style.textAlign="center",t.style.background="#000",h.appendChild(t),t.addEventListener("click",(t=>{P(e)?.cleaner(),P(e)?.remove()}))}}function r(t){(e.group||"general"===t)&&(Object.values(i).forEach((e=>e.style.display="none")),Object.values(s).forEach((e=>e.style.opacity="0.3")),i[t].style.display="block",s[t].style.opacity="1")}return r("general"),{active:function(e){r("layer"),e.group||r("general")},getEditor:function(e){return t[e]},turn:r,selectShape:function(e){a[e].click()}}}(M),M.centerdot=new class{getGraphic(){return this.graphic}getPosition(){let e=this.getGraphic();return{x:e.x,y:e.y}}setPosition({x:e,y:t}){let i=this.getGraphic();i.x=e,i.y=t,this.setLinePos()}setLinePos(){let e=this.line_verti,t=this.line_hori,i=this.getGraphic(),s=this.width,a=this.height;t.ax=i.x,t.ay=0,t.bx=i.x,t.by=a,e.ax=0,e.ay=i.y,e.bx=s,e.by=i.y}constructor({global:e,width:i,height:s}){let a=this,{app:n,group:o}=e;this.width=i,this.height=s;let l=new PIXI.Graphics;l.zIndex=1,this.graphic=l,l.lineStyle(0),l.alpha=.5,l.beginFill(16777215,1),l.drawRect(-10,-10,20,20),l.endFill(),n.stage.addChild(l),d.bind(l)({x:i/2,y:s/2,group:o,global:e});let r=new t;r.tint=16777215,r.thickness=1,r.ax=0,r.ay=0,r.bx=0,r.by=0,n.stage.addChild(r);let c=new t;c.tint=16777215,c.thickness=1,c.ax=0,c.ay=0,c.bx=0,c.by=0,n.stage.addChild(c),this.line_verti=c,this.line_hori=r,this.setLinePos();let p=null,u=null,g=null;h(l,["mousedown","touchstart"],(function(e){this.data=e.data,this.dragging=!0;const t=this.data.getLocalPosition(this.parent);p=t,u={x:0,y:0},g={x:l.x,y:l.y}})),h(l,["mousemove","touchmove"],(function(t){if(this.dragging){const t=this.data.getLocalPosition(this.parent);let i={x:t.x-p.x,y:t.y-p.y};u.x+=i.x,u.y+=i.y,p=t,d.bind(l)({x:u.x+g.x,y:u.y+g.y,group:o,global:e}),a.setLinePos()}})),h(l,["mouseup","mouseupoutside","touchend","touchendoutside"],(function(){this.dragging=!1,this.data=null,p=null,u=null}))}}({global:M,width:i,height:s}),M.editor.getEditor("general").value=JSON.stringify({scale:M.term},void 0,3),function(e,t){const{group:i}=e;if(t=JSON.parse(t)){{let i={...t};delete i.layers,delete i.pivotpoint,e.editor.getEditor("general").value=JSON.stringify(i,void 0,3)}e.centerdot.setPosition(t.pivotpoint),t.layers.forEach((t=>{y(e);let i=L(e);i.setJSON(t),["polygon","rect","circle"].forEach((s=>{i.getGroup().class=s,t.dots[s].forEach((t=>A(t,e)))})),e.editor.selectShape(t.class)})),e.editor.turn("layer")}}(M,localStorage.getItem("working")),M.editor.active(M)}))})();
//# sourceMappingURL=bundle.js.map